<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
<main id="masonry">
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>
</main>

<script>
  window.onload = (() => {

    let number = 0  // 记录替换过图片的索引
    let imgList = Array.from(document.getElementsByTagName('img'))
    let imgListLength = Array.from(document.getElementsByTagName('img')).length
    let seeHeight = document.documentElement.clientHeight

    /**
     *
     * @param fn        需要防抖执行的函数
     * @param delay     保证scroll事件不被完全锁死
     * @param atleast   当超过atleast毫秒,则立即执行此函数,否则延迟delay毫秒执行该函数
     * @returns {Function}
     */
    function throttle (fn, delay, atleast) {
      let timeout = null
      let startTime = new Date()
      return function () {
        let curTime = new Date()
        clearTimeout(timeout) //保证在同一delay时间内只被触发一次
        if (curTime - startTime >= atleast) {
          fn()
          startTime = curTime
        } else {
          timeout = setTimeout(fn, delay)
        }
      }
    }

    const lazyLoad = function () {
      console.log('被调用了')
      for (let i = number; i < imgListLength; i++) {
        let singleImg = imgList[i]
        //当前图片的顶部到可视区域的值                            当前图片的底部不能超过可视区域
        if (singleImg.getBoundingClientRect().top < seeHeight && singleImg.getBoundingClientRect().bottom > 0) {
          console.log('bottom', singleImg.getBoundingClientRect().bottom)
          setTimeout(() => {
            singleImg.src = singleImg.getAttribute('temp-src')
            singleImg.style.border = '1px solid orangeRed'
          }, 1000)
          number = number + 1
        }
      }
    }

    function init () {
      setTimeout(() => {
        lazyLoad()
      }, 1000)
    }

    init()

    window.addEventListener('scroll', throttle(lazyLoad, 500, 900), false)

  })
</script>
</body>
</html>