<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="./macy.js"></script>
    <link rel="stylesheet" href="./index2.css">
</head>
<body>
<main id="masonry">
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765996-f5a5719e-3ffd-11e8-898d-cb021971c0e3.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38765997-f5d8c472-3ffd-11e8-966f-73f1b7b650de.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766017-44825b42-3ffe-11e8-9c5e-ebdb15f0fcea.jpg"
             alt="">
    </div>

    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766041-ac459348-3ffe-11e8-915a-97f1b63e3faa.jpg"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766042-ac8b144a-3ffe-11e8-93cf-4200e9c031ed.png"
             alt="">
    </div>
    <div class="imgContainer-item">
        <img src='./loading.gif'
             temp-src="https://user-images.githubusercontent.com/23348422/38766043-acd514b4-3ffe-11e8-8578-9f714866403a.jpg"
             alt="">
    </div>
</main>

<script>
  window.onload = (() => {

    let number = 0
    let resortFlag = false
    let imgList = Array.from(document.getElementsByTagName('img'))
    let imgListLength = Array.from(document.getElementsByTagName('img')).length
    let seeHeight = document.documentElement.clientHeight
    let newMacy = function () {
      return new Macy({
        container: '#masonry', // 图像列表容器id
        trueOrder: false,
        waitForImages: false,
        useOwnImageLoader: false,
        debug: true,

        //设计间距
        margin: {
          x: 10,
          y: 10,
        },
        //设置列数
        columns: 3,
        //定义不同分辨率（1200，940，520，400这些是分辨率）
        breakAt: {
          1200: {
            columns: 5,
            margin: {
              x: 23,
              y: 4,
            },
          },
          940: {
            margin: {
              y: 23,
            },
          },
          520: {
            columns: 3,
            margin: 3,
          },
          400: {
            columns: 2,
          },
        },
      })
    }

    function promiseMacy () {
      return new Promise((resolve, reject) => {
        newMacy()
        setTimeout(() => {
          resolve()
        }, 1000)
      })
    }

    function throttle (fn, delay, atleast) {
      let timeout = null
      let startTime = new Date()
      return function () {
        let curTime = new Date()
        clearTimeout(timeout)
        if (curTime - startTime >= atleast) {
          fn()
          startTime = curTime
        } else {
          timeout = setTimeout(fn, delay)
        }
      }
    }

    function resort () {
      console.log('-------------调用了resort---------------')
      promiseMacy()
      for (let i = number; i < imgListLength; i++) {
        let singleImg = imgList[i]
        if (singleImg.getBoundingClientRect().top < seeHeight) {
          if (singleImg.src === singleImg.getAttribute('temp-src')) {
            singleImg.style.border = '2px solid green'
          } else { //需要赋值
            resortFlag = true
            singleImg.style.border = '2px solid blue'
            singleImg.src = singleImg.getAttribute('temp-src')
          }
        }
      }

      if (resortFlag = true) {
        promiseMacy().then(() => {
          resortFlag = false
          let tempNumber = 0
          //TODO 20是可视区域显示图片的最大数量
          number > 20 ? tempNumber = number - 20 : tempNumber = number
          console.log('tempNumber', tempNumber)
          for (let i = tempNumber; i < imgListLength; i++) {
            let singleImg = imgList[i]
            if (singleImg.getBoundingClientRect().top < seeHeight) {
              if (singleImg.src === singleImg.getAttribute('temp-src')) {
                singleImg.style.border = '2px solid green'
              } else { //需要赋值
                singleImg.src = singleImg.getAttribute('temp-src')
              }
            }
          }
        })
      }
    }

    const lazyLoad = function () {
      for (let i = number; i < imgListLength; i++) {
        let singleImg = imgList[i]
        if (singleImg.getBoundingClientRect().top < seeHeight) {
          singleImg.src = singleImg.getAttribute('temp-src')
          number = number + 1
        }
      }
      resort()
    }

    function init () {
      promiseMacy().then(() => {
        lazyLoad()
      })
    }

    init()
    // window.addEventListener('scroll', lazyLoad, false)
    window.addEventListener('scroll', throttle(lazyLoad, 500, 1000), false)

  })
</script>
</body>
</html>